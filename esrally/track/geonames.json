{
  "meta": {
    "#COMMENT#": " can be derived from file name -> convention over configuration",
    "name": "geonames",
    "short-description": "Standard benchmark in Rally (8.6M POIs from Geonames)",
    "description": "This test indexes 8.6M documents (POIs from Geonames, total 2.8 GB json) using 8 client threads and 5000 docs per bulk request against Elasticsearch",
    "data-url": "http://benchmarks.elasticsearch.org.s3.amazonaws.com/corpora/geonames"
  },
  "indices": [
    {
      "name": "geonames",
      "types": [
        {
          "#COMMENT#": "Allow generators here - how do we run the generator (i.e. arbitrary Python code)?",
          "name": "type",
          "mapping": "mappings.json",
          "documents": "documents.json.bz2",
          "document-count": 8647880,
          "compressed-bytes": 197857614,
          "uncompressed-bytes": 2790927196

        }
      ]
    }
  ],
  "#COMMENT": "'operations' just define all possible operations but this is not the actual execution schedule. The execution is defined in the 'challenges' block and it just refers to the defined operations. The intention between this separation is to allow reuse of operations",
  "operations": [
    {
      "index-append-default-settings": {
        "type": "index",
        "index-settings": {
          "#COMMENT#": "Rally will refuse to benchmark against a cluster that is in any other state as 'green'",
          "index.number_of_replicas": 0
        },
        "bulk-size": 5000,
        "clients": {
          "count": 8,
          "connections-per-client": 4,
          "compression": false,
          "#COMMENT#": "No authentication here - depends on server-side setup"
        }
      }
    },
    {
      "index-append-fast-settings": {
        "type": "index",
        "index-settings": {
          "index.number_of_replicas": 0,
          "index.refresh_interval": "30s",
          "index.number_of_shards": 6,
          "index.translog.flush_threshold_size": "4g"
        },
        "bulk-size": 5000,
        "clients": {
          "count": 8,
          "connections-per-client": 4,
          "compression": false
        }
      },
    },
    {
      "index-append-update-fast-settings": {
        "type": "index",
        "index-settings": {
          "index.number_of_replicas": 0,
          "index.refresh_interval": "30s",
          "index.number_of_shards": 6,
          "index.translog.flush_threshold_size": "4g"
        },
        "bulk-size": 5000,
        "conflicts": "sequential",
        "clients": {
          "count": 8,
          "connections-per-client": 4,
          "compression": false
        }
      }
    },
    {
      "stats": {
        "type": "stats",
        "warmup-iterations": 100,
        "iterations": 100,
        "clients": {
          "count": 1,
          "connections-per-client": 1,
          "compression": false
        }
      }
    },
    {
      "search": {
        "type": "search",
        "#COMMENT#": "This means 1 operation per second over all clients and connections",
        "target-throughput": 1,
        "warmup-iterations": 1000,
        "iterations": 1000,
        "clients": {
          "count": 8,
          "connections-per-client": 4,
          "compression": false
        },
        "queries": [
          {
            "default": {
              "body": {
                "query": {
                  "match_all": {}
                }
              }
            }
          },
          {
            "term": {
              "body": {
                "query": {
                  "term": {
                    "country_code": "AT"
                  }
                }
              }
            }
          },
          {
            "phrase": {
              "body": {
                "query": {
                  "match_phrase": {
                    "name": "Sankt Georgen"
                  }
                }
              }
            }
          },
          {
            "country_agg_uncached": {
              "cache": false,
              "body": {
                "size": 0,
                "aggs": {
                  "country_population": {
                    "terms": {
                      "field": "country_code"
                    },
                    "aggs": {
                      "sum_population": {
                        "sum": {
                          "field": "population"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          {
            "country_agg_cached": {
              "cache": true,
              "body": {
                "size": 0,
                "aggs": {
                  "country_population": {
                    "terms": {
                      "field": "country_code"
                    },
                    "aggs": {
                      "sum_population": {
                        "sum": {
                          "field": "population"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          {
            "scroll": {
              "type": "scroll",
              "size": 1000,
              "pages": 25,
              "body": {
                "query": {
                  "match_all": {}
                }
              }
            }
          }
        ]
      }
    }
  ],
  "challenges": [
    {
      "name": "append-no-conflicts",
      "#COMMENT#": "We will introduce concepts which allow to define traffic mixes, parallel execution etc. etc. Let's keep it simple for the first step",
      "schedule": [
        "index-append-default-settings",
        "stats",
        "search"
      ]
    },
    {
      "name": "append-fast-no-conflicts",
      "schedule": [
        "index-append-fast-settings"
      ]
    },
    {
      "name": "append-fast-with-conflicts",
      "schedule": [
        "index-append-update-fast-settings"
      ]
    }

  ]
}

